[env]
# Required environment variables (no default values)
CURRENT_USER = { script = ["whoami"] }
MYNIX_REPO_PATH = { script = ["pwd"] }
HOST_PURPOSE = { script = ["echo ${HOST_PURPOSE}"] }

# System detection (for future cross-platform support)
SYSTEM_TYPE = { script = ["uname -s"] }
ARCH_TYPE = { script = ["uname -m"] }

[tasks.apply]
mac_alias = "darwin:apply"

[tasks."darwin:apply"]
script = '''
nix build .#darwinConfigurations.default.system --extra-experimental-features 'nix-command flakes' --impure
MYNIX_REPO_PATH="${MYNIX_REPO_PATH}" sudo -E ./result/sw/bin/darwin-rebuild switch --flake ".#default" --impure
'''
